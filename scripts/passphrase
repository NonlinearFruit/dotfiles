#!/usr/bin/env nu

# Generates a cryptographically secure passphrase
def main [
  --with-entropy               # Print the entropy of the passphrase
  --number-of-numbers: int = 0 # Number of single digit numbers in passphrase
  number_of_words?: int = 1    # Number of words in passphrase
  ] {
  let ipsum_structure = ipsum --with-entropy=$with_entropy --as-json $number_of_words
    | from json
  let numbers = 1..$number_of_numbers | each { random-number } | str join ''
  let passphrase = $ipsum_structure
    | get words
    | append $numbers
    | str join '#'
  if $with_entropy {
    let number_entropy = (10 | math log 2 | $in * $number_of_numbers)
    print ({
      passphrase: $passphrase
      entropy: ($ipsum_structure.entropy + $number_of_numbers)
    })
  } else {
    print $passphrase
  }
  echo $passphrase | clip copy
  print "Copied!"
}

def random-number [max: int = 10] {
    let max_int = 16777216
    od -N3 -An -i /dev/urandom
    | into int
    | $in * $max / $max_int
    | math round
}

